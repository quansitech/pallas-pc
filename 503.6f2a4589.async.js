"use strict";(self.webpackChunk_quansitech_pallas_pc=self.webpackChunk_quansitech_pallas_pc||[]).push([[503],{80503:function(P,b,s){s.r(b);var h=s(15009),i=s.n(h),v=s(97857),c=s.n(v),E=s(99289),f=s.n(E),o=s(44559);b.default={upload:function(){var n=f()(i()().mark(function u(a,d,e){var t,p,m,O,r,j,y,g,D,T;return i()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t=new FormData,p=new URLSearchParams(d),e&&p.append("hash_id",e),m=a.type,m){_.next=8;break}return _.next=7,o.Z.getFileType.start(a);case 7:m=_.sent;case 8:return p.append("vendor_type","aliyun_oss"),p.append("file_type",m),p.append("title",a.name),_.next=13,fetch(decodeURIComponent(p.toString()));case 13:return O=_.sent,_.next=16,O.json();case 16:if(r=_.sent,parseInt(r.status)!==2){_.next=19;break}return _.abrupt("return",{file_id:r.file_id,url:r.file_url,status:parseInt(r.status)});case 19:j=r.oss_meta?JSON.parse(r.oss_meta):{},y=c()(c()({key:r.dir+o.Z.getSuffix(a.name),policy:r.policy,OSSAccessKeyId:r.accessid,success_action_status:"200",callback:r.callback,signature:r.signature},JSON.parse(r.callback_var)),j);for(g in y)t.append(g,y[g]);return t.append("file",a),_.next=25,fetch(r.host,{method:"POST",body:t});case 25:return D=_.sent,_.next=28,D.json();case 28:return T=_.sent,_.abrupt("return",T);case 30:case"end":return _.stop()}},u)}));function l(u,a,d){return n.apply(this,arguments)}return l}()}},44559:function(P,b,s){var h=s(15009),i=s.n(h),v=s(99289),c=s.n(v),E={getFileType:{fileToArrayBuffer:function(){var f=c()(i()().mark(function n(l,u){var a;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=new FileReader,a.onload=function(t){if(typeof u=="function")return u(t.target.result)},a.readAsArrayBuffer(l);case 3:case"end":return e.stop()}},n)}));function o(n,l){return f.apply(this,arguments)}return o}(),getFileTypeViaHeader:function(o){for(var n=new Uint8Array(o),l=n.slice(0,4),u=n.slice(0,16),a="",d="",e,t=0;t<l.length;t++)a+=l[t].toString(16);for(var p=0;p<u.length;p++)d+=u[p].toString(16);switch(a){case"89504e47":e="image/png";break;case"47494638":e="image/gif";break;case"ffd8ffDB":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":e="image/jpeg";break;case"00020":case"00018":case"00024":case"0001c":d.lastIndexOf("000")===22?e="image/heic":e="unknown";break;default:e="unknown";break}return e},start:function(){var f=c()(i()().mark(function n(l){var u,a;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=this,a=new Promise(function(t){u.fileToArrayBuffer(l,function(p){var m=u.getFileTypeViaHeader(p);t(m)})}),e.abrupt("return",a);case 3:case"end":return e.stop()}},n,this)}));function o(n){return f.apply(this,arguments)}return o}()},getSuffix:function(o){var n=o.lastIndexOf("."),l="";return n!==-1&&(l=o.substring(n)),l}};b.Z=E}}]);
