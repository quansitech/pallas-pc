"use strict";(self.webpackChunk_quansitech_pallas_pc=self.webpackChunk_quansitech_pallas_pc||[]).push([[503],{80503:function(P,b,r){r.r(b);var h=r(15009),i=r.n(h),v=r(97857),c=r.n(v),E=r(99289),f=r.n(E),o=r(44559);b.default={upload:function(){var s=f()(i()().mark(function u(a,d,e){var t,p,m,O,n,j,y,g,D,T;return i()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t=new FormData,p=new URLSearchParams(d),e&&p.append("hash_id",e),m=a.type,m){_.next=8;break}return _.next=7,o.Z.getFileType.start(a);case 7:m=_.sent;case 8:return p.append("vendor_type","aliyun_oss"),p.append("file_type",m),p.append("title",a.name),_.next=13,fetch(decodeURIComponent(p.toString()));case 13:return O=_.sent,_.next=16,O.json();case 16:if(n=_.sent,parseInt(n.status)!==2){_.next=19;break}return _.abrupt("return",{file_id:n.file_id,url:n.file_url});case 19:j=n.oss_meta?JSON.parse(n.oss_meta):{},y=c()(c()({key:n.dir+o.Z.getSuffix(a.name),policy:n.policy,OSSAccessKeyId:n.accessid,success_action_status:"200",callback:n.callback,signature:n.signature},JSON.parse(n.callback_var)),j);for(g in y)t.append(g,y[g]);return t.append("file",a),_.next=25,fetch(n.host,{method:"POST",body:t});case 25:return D=_.sent,_.next=28,D.json();case 28:return T=_.sent,_.abrupt("return",T);case 30:case"end":return _.stop()}},u)}));function l(u,a,d){return s.apply(this,arguments)}return l}()}},44559:function(P,b,r){var h=r(15009),i=r.n(h),v=r(99289),c=r.n(v),E={getFileType:{fileToArrayBuffer:function(){var f=c()(i()().mark(function s(l,u){var a;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=new FileReader,a.onload=function(t){if(typeof u=="function")return u(t.target.result)},a.readAsArrayBuffer(l);case 3:case"end":return e.stop()}},s)}));function o(s,l){return f.apply(this,arguments)}return o}(),getFileTypeViaHeader:function(o){for(var s=new Uint8Array(o),l=s.slice(0,4),u=s.slice(0,16),a="",d="",e,t=0;t<l.length;t++)a+=l[t].toString(16);for(var p=0;p<u.length;p++)d+=u[p].toString(16);switch(a){case"89504e47":e="image/png";break;case"47494638":e="image/gif";break;case"ffd8ffDB":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":e="image/jpeg";break;case"00020":case"00018":case"00024":case"0001c":d.lastIndexOf("000")===22?e="image/heic":e="unknown";break;default:e="unknown";break}return e},start:function(){var f=c()(i()().mark(function s(l){var u,a;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=this,a=new Promise(function(t){u.fileToArrayBuffer(l,function(p){var m=u.getFileTypeViaHeader(p);t(m)})}),e.abrupt("return",a);case 3:case"end":return e.stop()}},s,this)}));function o(s){return f.apply(this,arguments)}return o}()},getSuffix:function(o){var s=o.lastIndexOf("."),l="";return s!==-1&&(l=o.substring(s)),l}};b.Z=E}}]);
